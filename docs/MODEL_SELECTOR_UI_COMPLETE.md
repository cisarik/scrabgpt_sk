# Model Selector UI - Kompletn√° Implement√°cia

## üìã Prehƒæad

Vytvoren√Ω nov√Ω **inteligentn√Ω v√Ωber modelu s agentom** v **slovenƒçine** s async aktualiz√°ciami UI, zobrazen√≠m thinking procesu a ukladan√≠m v√Ωsledkov.

## ‚úÖ ƒåo bolo implementovan√©

### 1. Nov√Ω Dialog - `ModelSelectorDialog`

**S√∫bor:** `scrabgpt/ui/model_selector_dialog.py` (540+ riadkov)

**Funkcie:**
- ‚úÖ **Slovensk√© UI** - v≈°etky texty v slovenƒçine
- ‚úÖ **Async spracovanie** - agent be≈æ√≠ v samostatnom vl√°kne
- ‚úÖ **Live aktualiz√°cie** - UI sa aktualizuje poƒças pr√°ce agenta
- ‚úÖ **Zobrazenie thinking** - pou≈æ√≠vateƒæ vid√≠ ƒço agent "prem√Ω≈°ƒæa"
- ‚úÖ **Progress bar** - indik√°tor priebehu
- ‚úÖ **Log v√Ωstup** - detailn√Ω v√Ωpis ƒçinnosti agenta
- ‚úÖ **Dropdown menu** - pekn√Ω v√Ωber z n√°jden√Ωch modelov
- ‚úÖ **Detaily modelu** - ceny, context window, output tokens, sk√≥re
- ‚úÖ **Ukladanie do s√∫boru** - v√Ωsledky sa ulo≈æia do `openai.models`

**≈†t√Ωl:**
- Tmav√° t√©ma (#1a1a1a pozadie)
- Menej zelenej farby (modr√° pre akcenty #5a9fd4)
- Podobn√Ω ≈°t√Ωl ako Settings dialog
- Monospace font pre log v√Ωstup

### 2. Aktualizovan√Ω Widget - `ModelDisplayWidget`

**Zmeny:**
- ‚úÖ Button premenovan√Ω z "Skontrolova≈• Najlep≈°√≠" na **"‚öôÔ∏è Nastavi≈• Model"**
- ‚úÖ Nov√Ω ≈°t√Ωl tlaƒçidla (menej zelenej, viac neutr√°lnej)
- ‚úÖ Otv√°ra nov√Ω `ModelSelectorDialog` namiesto progress dialogu
- ‚úÖ Jednoduch≈°ia implement√°cia (vymazan√Ω star√Ω k√≥d)

### 3. Agent Worker Thread

**Trieda:** `AgentWorkerThread` v `model_selector_dialog.py`

**Sign√°ly:**
- `status_updated` - aktualiz√°cia statusu (napr. "S≈•ahujem modely...")
- `log_message` - spr√°va do logu (HTML form√°t)
- `thinking` - thinking proces agenta
- `models_found` - n√°jden√© modely
- `finished_signal` - dokonƒçenie
- `error_occurred` - chyba

**Proces:**
1. **Stiahnutie modelov** z OpenAI API
2. **Pridanie cien** z datab√°zy
3. **Vytvorenie agenta** s BALANCED krit√©riom
4. **Filtrovanie** (text generation, no preview, no legacy)
5. **Scoring** jednotliv√Ωch modelov
6. **Zoradenie** podƒæa sk√≥re (top 15)
7. **Emitnutie v√Ωsledkov**

### 4. V√Ωstupn√Ω S√∫bor - `openai.models`

**Lok√°cia:** Kore≈àov√Ω adres√°r projektu

**Form√°t:**
```json
{
  "models": [
    {
      "id": "gpt-4o",
      "tier": "flagship",
      "context_window": 128000,
      "max_output_tokens": 16384,
      "pricing": {
        "input": 0.0025,
        "output": 0.01
      },
      "score": 85.5,
      "reasoning": "Najv√Ωkonnej≈°√≠ model s najv√§ƒç≈°√≠m context window..."
    }
  ],
  "count": 15,
  "timestamp": "2025-01-20T10:30:00"
}
```

## üé® UI Vzhƒæad

### Farby

```
Pozadie dialogu:     #1a1a1a (tmav√°)
Text:                #e8e8e8 (svetl√°)
Sekund√°rny text:     #a8a8a8 (≈°ed√°)

Akcenty (modr√°):     #5a9fd4
Pozadie komponentov: #2a2a2a
Bordery:             #404040

Progress bar:        #5a9fd4 (modr√°)
Success:             #6ac46a (zelen√°)
Error:               #d46a6a (ƒçerven√°)
Thinking:            #8a9aaa (≈°edo-modr√°)
```

### Layout

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ ü§ñ Inteligentn√Ω V√Ωber Modelu                   ‚îÇ
‚îÇ Agent analyzuje dostupn√© OpenAI modely...      ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ [========== Progress Bar ==========]           ‚îÇ
‚îÇ ‚è≥ Inicializujem agenta...                     ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ üìã Priebeh pr√°ce agenta:                       ‚îÇ
‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ ‚îÇ ‚Üí Kontaktujem OpenAI API...             ‚îÇ   ‚îÇ
‚îÇ ‚îÇ üí≠ Potrebujem z√≠ska≈• zoznam modelov     ‚îÇ   ‚îÇ
‚îÇ ‚îÇ ‚úì Naƒç√≠tan√Ωch 47 modelov                 ‚îÇ   ‚îÇ
‚îÇ ‚îÇ ‚Üí Naƒç√≠tavam cenn√≠k z datab√°zy...        ‚îÇ   ‚îÇ
‚îÇ ‚îÇ üí≠ Mus√≠m spoji≈• modely s cenami         ‚îÇ   ‚îÇ
‚îÇ ‚îÇ ‚úì Pridan√© ceny pre 42 modelov           ‚îÇ   ‚îÇ
‚îÇ ‚îÇ ‚Üí Vyhodnocujem modely...                ‚îÇ   ‚îÇ
‚îÇ ‚îÇ üí≠ Budem hodnoti≈• podƒæa v√Ωkonu a ceny   ‚îÇ   ‚îÇ
‚îÇ ‚îÇ ‚úì Zoraden√Ωch top 15 modelov             ‚îÇ   ‚îÇ
‚îÇ ‚îÇ                                          ‚îÇ   ‚îÇ
‚îÇ ‚îÇ üéØ Najlep≈°√≠ model:                      ‚îÇ   ‚îÇ
‚îÇ ‚îÇ gpt-4o (sk√≥re: 85.5/100)                ‚îÇ   ‚îÇ
‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ ‚úÖ N√°jden√© Modely:                             ‚îÇ
‚îÇ                                                 ‚îÇ
‚îÇ Vyberte model: [üëë gpt-4o ‚Äî $2.50/$10.00 ‚ñº]   ‚îÇ
‚îÇ                                                 ‚îÇ
‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ ‚îÇ Model: gpt-4o                           ‚îÇ   ‚îÇ
‚îÇ ‚îÇ Typ: flagship                           ‚îÇ   ‚îÇ
‚îÇ ‚îÇ Context window: 128,000 tokenov         ‚îÇ   ‚îÇ
‚îÇ ‚îÇ Max output: 16,384 tokenov              ‚îÇ   ‚îÇ
‚îÇ ‚îÇ Ceny: $0.0025 / $0.0100 za 1M tokenov   ‚îÇ   ‚îÇ
‚îÇ ‚îÇ Sk√≥re agenta: 85.5/100                  ‚îÇ   ‚îÇ
‚îÇ ‚îÇ                                          ‚îÇ   ‚îÇ
‚îÇ ‚îÇ Od√¥vodnenie:                             ‚îÇ   ‚îÇ
‚îÇ ‚îÇ Najv√Ωkonnej≈°√≠ model s najv√§ƒç≈°√≠m         ‚îÇ   ‚îÇ
‚îÇ ‚îÇ context window. V√Ωborn√Ω pomer           ‚îÇ   ‚îÇ
‚îÇ ‚îÇ v√Ωkon/cena pre n√°roƒçn√© √∫lohy.           ‚îÇ   ‚îÇ
‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                           [‚úó Zru≈°i≈•] [‚úì Pou≈æi≈•]‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## üîÑ Priebeh Pr√°ce Agenta

### F√°zy (v slovenƒçine)

1. **‚è≥ Inicializujem agenta...**
   - Agent sa pripravuje

2. **üì• S≈•ahujem zoznam modelov z OpenAI...**
   ```
   ‚Üí Kontaktujem OpenAI API...
   üí≠ Potrebujem z√≠ska≈• zoznam v≈°etk√Ωch dostupn√Ωch modelov
   ‚úì Naƒç√≠tan√Ωch 47 modelov
   ```

3. **üí∞ Prid√°vam inform√°cie o cen√°ch...**
   ```
   ‚Üí Naƒç√≠tavam cenn√≠k z datab√°zy...
   üí≠ Mus√≠m spoji≈• modely s ich cenami, aby som mohol porovna≈•
   ‚úì Pridan√© ceny pre 42 modelov
   ```

4. **ü§ñ Agent analyzuje modely...**
   ```
   ‚Üí Vyhodnocujem modely podƒæa v√Ωkonu a ceny...
   üí≠ Budem hodnoti≈• ka≈æd√Ω model podƒæa:
      1) v√Ωkonu (tier, context, output)
      2) ceny (vstup + v√Ωstup)
      3) dostupnosti
   ```

5. **üìä Poƒç√≠tam sk√≥re pre jednotliv√© modely...**
   ```
   ‚Üí Aplikujem v√°hovan√Ω scoring algoritmus...
   üí≠ Po filtrovan√≠ zostalo 35 vhodn√Ωch modelov
   ‚úì Zoraden√Ωch top 15 modelov
   ```

6. **‚úÖ Hotovo!**
   ```
   üéØ Najlep≈°√≠ model:
   gpt-4o (sk√≥re: 85.5/100)
   Najv√Ωkonnej≈°√≠ model s najv√§ƒç≈°√≠m context window...
   ```

## üìä Sk√≥rovanie Modelov

Agent pou≈æ√≠va v√°≈æen√Ω scoring algoritmus:

### Krit√©rium: BALANCED

```
Performance (40%):
  - Tier (flagship=100, reasoning=90, premium=70...)
  - Context window bonus (+20 pre 128k)
  - Max output bonus (+10 pre 16k)

Cost (40%):
  - Invern√° line√°rna ≈°k√°la
  - Lacnej≈°√≠ = vy≈°≈°ie sk√≥re
  - Rozsah: $0.10 - $30.00 / 1M tokenov

Availability (20%):
  - Model je dostupn√Ω = 100
```

**V√Ωsledn√© sk√≥re:** 0-100 bodov

### Pr√≠klad V√Ωstupu

```
Top 5 modelov:

1. gpt-4o                    85.5/100  üëë flagship
2. gpt-4o-mini               82.3/100  üí® efficient  
3. gpt-5-mini                80.1/100  üí® efficient
4. gpt-5                     78.5/100  üëë flagship
5. gpt-4-turbo              75.2/100  ‚≠ê premium
```

## üíæ Ukladanie V√Ωsledkov

### Automatick√© Ulo≈æenie

Po dokonƒçen√≠ anal√Ωzy sa modely automaticky ulo≈æia do:

```
/home/agile/scrabgpt_sk/openai.models
```

### Log Spr√°va

```
‚úì Modely ulo≈æen√© do openai.models
```

## üöÄ Pou≈æitie

### 1. Otvorenie Dialogu

Kliknite na tlaƒçidlo **"‚öôÔ∏è Nastavi≈• Model"** v toolbare (vedƒæa zobrazenia aktu√°lneho modelu).

### 2. Sledovanie Priebehu

Sledujte:
- **Progress bar** - v≈°eobecn√Ω priebeh
- **Status label** - aktu√°lna f√°za
- **Log v√Ωstup** - detailn√Ω priebeh s thinking procesom

### 3. V√Ωber Modelu

Po dokonƒçen√≠:
1. Dropdown menu zobraz√≠ top 15 modelov
2. Ka≈æd√Ω model m√° emoji podƒæa typu
3. Zobrazen√© s√∫ ceny za 1M tokenov
4. Vyberte model z dropdown menu
5. Preƒç√≠tajte si detaily (ceny, context, sk√≥re, od√¥vodnenie)

### 4. Potvrdenie

Kliknite na **"‚úì Pou≈æi≈• Vybran√Ω Model"**:
- Model sa ulo≈æ√≠ do `.env` s√∫boru
- Zobraz√≠ sa potvrdenie
- Zmeny sa prejavia po re≈°tarte aplik√°cie

## üîß Technick√© Detaily

### Async Implement√°cia

```python
class AgentWorkerThread(QThread):
    """Worker thread for agent execution."""
    
    status_updated = Signal(str)
    log_message = Signal(str)
    thinking = Signal(str)
    models_found = Signal(list)
    finished_signal = Signal()
    error_occurred = Signal(str)
    
    def run(self) -> None:
        # 1. Fetch models from OpenAI
        # 2. Enrich with pricing
        # 3. Create agent
        # 4. Filter and score models
        # 5. Emit results
```

### Sign√°ly a Sloty

```python
# Connect signals in dialog __init__
self.agent_thread.status_updated.connect(self._on_status_update)
self.agent_thread.log_message.connect(self._on_log_message)
self.agent_thread.thinking.connect(self._on_thinking)
self.agent_thread.models_found.connect(self._on_models_found)
self.agent_thread.finished_signal.connect(self._on_agent_finished)
self.agent_thread.error_occurred.connect(self._on_agent_error)
```

### Thread Safety

- ‚úÖ V≈°etky UI aktualiz√°cie cez sign√°ly
- ‚úÖ ≈Ωiadne priame volania UI z worker threadu
- ‚úÖ Thread reference ulo≈æen√° aby sa predi≈°lo garbage collection

## üìù Textov√© Re≈•azce (Slovenƒçina)

### Status Messages

```
‚è≥ Inicializujem agenta...
üì• S≈•ahujem zoznam modelov z OpenAI...
üí∞ Prid√°vam inform√°cie o cen√°ch...
ü§ñ Agent analyzuje modely...
üìä Poƒç√≠tam sk√≥re pre jednotliv√© modely...
‚úÖ Hotovo! Vyberte model z dropdown menu.
‚ùå Chyba: [error message]
```

### Log Messages

```
‚Üí Kontaktujem OpenAI API...
‚úì Naƒç√≠tan√Ωch 47 modelov
‚Üí Naƒç√≠tavam cenn√≠k z datab√°zy...
‚úì Pridan√© ceny pre 42 modelov
‚Üí Vyhodnocujem modely podƒæa v√Ωkonu a ceny...
‚úì Zoraden√Ωch top 15 modelov
‚úì Modely ulo≈æen√© do openai.models
‚ö† Chyba pri ukladan√≠: [error]
```

### Thinking Messages

```
üí≠ Potrebujem z√≠ska≈• zoznam v≈°etk√Ωch dostupn√Ωch modelov
üí≠ Mus√≠m spoji≈• modely s ich cenami, aby som mohol porovna≈•
üí≠ Budem hodnoti≈• ka≈æd√Ω model podƒæa: 1) v√Ωkonu, 2) ceny, 3) dostupnosti
üí≠ Po filtrovan√≠ zostalo 35 vhodn√Ωch modelov
```

## üêõ O≈°etrenie Ch√Ωb

### Chyby API

```python
if not api_key:
    self.error_occurred.emit(
        "OPENAI_API_KEY nie je nastaven√Ω v .env s√∫bore"
    )
    return
```

### Chyby Naƒç√≠tania

```python
models = fetch_openai_models(api_key)
if not models:
    self.error_occurred.emit(
        "Nepodarilo sa z√≠ska≈• modely z OpenAI"
    )
    return
```

### Chyby Ukladania

```python
try:
    with open(output_file, "w") as f:
        json.dump(data, f, indent=2)
except Exception as e:
    log.exception("Error saving models")
    self._on_log_message(
        f"<span style='color: #d46a6a;'>‚ö† Chyba: {e}</span>"
    )
```

## üìä ≈†tatistiky

```
Nov√Ω k√≥d:           540+ riadkov
Upraven√Ω k√≥d:       120+ riadkov
Celkovo:            660+ riadkov

Dialog:             ModelSelectorDialog
Worker Thread:      AgentWorkerThread
Sign√°ly:            6
Status f√°zy:        6
Podporovan√© modely: Top 15 (zo v≈°etk√Ωch dostupn√Ωch)
```

## ‚úÖ Checklist Implement√°cie

- ‚úÖ Slovensk√© UI
- ‚úÖ Async spracovanie (QThread)
- ‚úÖ Live progress updates
- ‚úÖ Thinking process zobrazenie
- ‚úÖ Log v√Ωstup s farbami (HTML)
- ‚úÖ Progress bar
- ‚úÖ Dropdown menu s modelmi
- ‚úÖ Detaily modelu (ceny, specs, sk√≥re, reasoning)
- ‚úÖ Ukladanie do openai.models
- ‚úÖ ≈†t√Ωl ako Settings (menej zelenej)
- ‚úÖ Emoji pre typy modelov (üëëüí®‚≠êüß†üì¶)
- ‚úÖ O≈°etrenie ch√Ωb
- ‚úÖ Thread safety
- ‚úÖ Aktualiz√°cia .env s√∫boru
- ‚úÖ Potvrdzovacie dial√≥gy

## üéØ Status: ‚úÖ COMPLETE

Implement√°cia je **kompletn√° a pripraven√° na testovanie!**

---

**Autor:** Droid AI Assistant  
**D√°tum:** 2025-01-20  
**Verzia:** 1.0
